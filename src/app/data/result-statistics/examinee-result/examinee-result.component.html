<div class="container">
  <ol class="breadcrumb">
    <li><a href="#">首页</a></li>
    <li>数据中心</li>
    <li>成绩统计</li>
    <li class="active">考生成绩</li>
  </ol>
</div>

<div class="container">
  <!-- Nav tabs -->
  <ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a aria-controls="examineeResult" role="tab" data-toggle="tab"
                                              (click)="tab='examinee'">考生成绩</a></li>
    <li role="presentation" class="disabled"><a aria-controls="lateralComparison" onclick="return false;">横向对比</a>
    </li>
    <li role="presentation" class="disabled"><a aria-controls="verticalComparison" onclick="return false;">纵向对比</a>
    </li>
  </ul>


  <div class="tab-content">
    <!--已完成考试 start-->
    <div role="tabpanel" class="tab-pane active" id="finishedExam" *ngIf="tab==='examinee'">
      <div class="col-sm-4">
        <select class="form-control" [(ngModel)]="selectedExam">
          <option *ngFor="let exam of exams | async, let i = index" [selected]="i==0" [ngValue]="exam">
            {{exam.examName}}
          </option>
        </select>
      </div>
      <div class="row">
        <div class="col-sm-12 col-lg-12">
          <form id="editExamForm" method="post" class="form-inline" action="#">
            <div class="input-group" *ngIf="selectedExam?.type=='联考'">
              <span class="input-group-addon">学校</span>
              <select class="form-control" [(ngModel)]="selectedSchool" name="selectedSchool">
                <option *ngFor="let school of schools, let i = index" [selected]="i==0">{{school}}</option>
              </select>
            </div>
            <div class="input-group">
              <span class="input-group-addon">年级</span>
              <select class="form-control" [(ngModel)]="selectedGrade" name="selectedGrade">
                <option selected>全部</option>
                <option *ngFor="let grade of selectedExam?.grades, let i = index" [ngValue]="grade">{{grade.grade_name}}</option>
              </select>
            </div>
            <div class="input-group">
              <span class="input-group-addon">方向</span>
              <select class="form-control" [(ngModel)]="selectedBranch" name="selectedBranch">
                <option selected>全部</option>
                <option>理科</option>
                <option>文科</option>
                <option>艺术</option>
                <option>体育</option>
              </select>
            </div>
            <div class="input-group">
              <span class="input-group-addon">学科</span>
              <select class="form-control" [(ngModel)]="selectedSubject" name="selectedSubject">
                <option selected>全部</option>
                <option *ngFor="let subject of selectedExam?.subjects" [ngValue]="subject">{{subject.name}}</option>
              </select>
            </div>
            <div class="input-group">
              <span class="input-group-addon">班级</span>
              <select class="form-control" [(ngModel)]="selectedClass" name="selectedSubject">
                <option selected>全部</option>
                <option *ngFor="let class of selectedExam?.classes" [ngValue]="class">{{class.name}}</option>
              </select>
            </div>
            <div class="input-group">
              <input type="text" class="form-control" name="text" [(ngModel)]="text" placeholder="请输入姓名或者考号">
            </div>
            <div class="input-group">
              <a class="btn btn-default" title="查询" (click)="reload()">查询</a>
            </div>
          </form>
        </div>
      </div>
      <ngx-datatable
        #examineeTable
        style="width: 100%"
        class="material striped"
        [rows]="results"
        [columnMode]="'flex'"
        [headerHeight]="60"
        [footerHeight]="50"
        [rowHeight]="'auto'"
        [selectionType]="false"
        [limit]="20"
        (resize)="onResize(column, newValue)"
      >
        <ngx-datatable-column name="序号" [flexGrow]="1">
          <ng-template let-row="row" let-rowIndex="rowIndex" ngx-datatable-cell-template>
            <strong>{{rowIndex}}</strong>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column prop="stuExamId" name="考号" [flexGrow]="1"
                              headerClass="header-bordered"></ngx-datatable-column>
        <ngx-datatable-column prop="name" name="姓名" [flexGrow]="1" headerClass="header-bordered"></ngx-datatable-column>
        <ngx-datatable-column prop="schname" name="单位" [flexGrow]="1"
                              headerClass="header-bordered"></ngx-datatable-column>
        <ngx-datatable-column name="成绩" [flexGrow]="6" headerClass="nopadding" cellClass="nopadding">
          <ng-template let-column="column" ngx-datatable-header-template>
            <div class="table-responsive" style="display: flex">
              <span *ngFor="let subject of resultHdr?.scores, let i = index" [ngStyle]="{width: subjectWidth}">
                <table class="table table-bordered table-condensed" style="margin: 0px;"> <tbody> <tr><th>{{subject.name}}</th></tr> </tbody> </table>
                <table class="table table-bordered table-condensed" style="margin: 0px;"> <tbody> <tr><th>成绩</th><th>排名</th></tr> </tbody> </table>
              </span>
              <span [ngStyle]="{width: subjectWidth}">
                <table class="table table-bordered table-condensed" style="margin: 0px;"> <tbody> <tr><th>总分</th></tr> </tbody> </table>
                <table class="table table-bordered table-condensed" style="margin: 0px;"> <tbody> <tr><th>成绩</th><th>排名</th></tr> </tbody> </table>
              </span>
            </div>
          </ng-template>
          <ng-template let-row="row" let-rowIndex="rowIndex" ngx-datatable-cell-template>
            <div class="table-responsive" style="display: flex">
              <table class="table table-bordered table-condensed" style="margin: 0px;">
                <tbody>
                <tr style="height:45px;">
                  <ng-container *ngFor="let subject of row.scores">
                    <td [ngStyle]="{width: subjectWidth2}">{{ subject.score}}</td>
                    <td [ngStyle]="{width: subjectWidth2}">{{ subject.rank}}</td>
                  </ng-container>
                  <td [ngStyle]="{width: subjectWidth2}">{{ row.score}}</td>
                  <td [ngStyle]="{width: subjectWidth2}">{{ row.rank}}</td>
                </tr>
                </tbody>
              </table>
            </div>

          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable>
    </div>
  </div>
</div>
